<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Location Based AR.js demo</title>
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  <script>
    window.onload = () => {                       navigator.geolocation.getCurrentPosition((position) => {
      document.querySelector('a-text').setAttribute('gps-entity-place', `latitude: ${position.coords.latitude}; longitude: ${position.coords.longitude};`)
      document.getElementById("location").innerHTML = `latitude: ${position.coords.latitude}; longitude: ${position.coords.longitude};`
      wikidataSearch(position.coords.latitude,position.coords.longitude)
    });
  }

  function wikidataSearch(lat, long){
    console.log(lat,long)
    alert("lat: "+ lat+" long: "+long)


    var url = "https://en.wikipedia.org/w/api.php";

    var params = {
      action: "query",
      generator: "geosearch",
      //  action=query&generator=geosearch&prop=coordinates|pageimages&ggscoord=37.7891838|-122.4033522
      prop: "coordinates|pageimages|dist",
      ggscoord: lat+"|"+long,
      ggsradius: 10000,
      ggslimit: 100,
      // titles: "Wikimedia Foundation",
      format: "json"
    };

    let params0 = {
      //https://en.wikipedia.org/w/api.php?action=query&list=geosearch&gscoord=37.7891838%7C-122.4033522&gsradius=10000&gslimit=100
      action: "query",
      list: "geosearch",
      gscoord: lat+"|"+long,
      prop: "coordinates|pageimages",
      gsradius: 10000,
      gslimit: 100,
      format: "json"
    }


    console.log("params", params)
    url = url + "?origin=*";
    Object.keys(params).forEach(function(key){url += "&" + key + "=" + params[key];});
    console.log(url)
    // fetch(url)
    // .then(function(response){return response.json();})
    // .then(function(response) {
    //   console.log(response)
    //   // var pages = response.query.pages;
    //   // console.log(pages)
    //   // for (var page in pages) {
    //   //   console.info(pages[page])
    //   //   console.log("Latitute: " + pages[page].coordinates[0].lat);
    //   //   console.log("Longitude: " + pages[page].coordinates[0].lon);
    //   // }
    // })
    // .catch(function(error){console.log(error);});
    fetch(url)
    .then(function(response){return response.json();})
    .then(function(response) {
      var pages = response.query.pages;
      console.log(pages)
      for (var page in pages) {
        console.info(pages[page])
        if (pages[page].coordinates != undefined){

          console.log("Latitute: " + pages[page].coordinates[0].lat);
          console.log("Longitude: " + pages[page].coordinates[0].lon);
        }
      }
    })
    .catch(function(error){console.log(error);});




  }
</script>
</head>

<body style="margin: 0; overflow: hidden;">
  <div id="location" style="positon:absolute,top:0px,left:0px,z-index:10">Bim</div>
  <a-scene
  vr-mode-ui="enabled: false"
  embedded
  arjs="sourceType: webcam; debugUIEnabled: false;"
  >
  <a-text
  value="No markers around"
  look-at="[gps-camera]"
  scale="5 5 5"
  ></a-text>
  <a-camera gps-camera rotation-reader> </a-camera>
</a-scene>
</body>
</html>
